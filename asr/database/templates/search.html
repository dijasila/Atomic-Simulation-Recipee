{% extends 'asr/database/templates/layout.html' %}

{% block title %}
Browse ASE Database
{% endblock %}

{% block head %}
<script src="{{ url_for('static', filename='search.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded',
                          function() {
                              update_table({{ session_id }}, 'query', '0');
                              },
                          false);
</script>
{% endblock %}

{% block content %}
<style>
table.search {
    border-collapse: separate;
    border-spacing: 0.5em 0.5em;
}
.ase-input {
    width: 100%;
}
</style>

<div class="container">
  {% block contenttitle %}
  <div class="row" style="padding-bottom:15px;padding-right:50px">
    <div class="col-lg-11">
      <div class="col-lg-9"><h1>Computational 1D materials database</h1></div>
      <div class="col-lg-2" style="float:right">
        <img alt="C2DB logo" width=300 src="https://cmr.fysik.dtu.dk/_images/c2db.png">
      </div>
    </div>
  </div>

  {% endblock %}

  <div class="well mt-2">
    <form id="mainFormID" class="navbar-form navbar-default mt-2"
          role="search"
          action="javascript:update_table({{ session_id }}, 'query', '0')">
      <div class="form-group" style="margin-top:5px;">
        <input type="text" name="query" id="formula-result"
               class="form-control mt-2 ase-input"
               value="{{ q }}"
               placeholder="Search formula e.g. MoS2" size="60">
        <button type="submit" class="btn btn-default">
          <i class="fa fa-search fa-1x" aria-hidden="true"></i>
        </button>

      <table class="search">
        <tr>
          <td>Calculations type</td><td>:</td>
          <td>
            <select name="calculator" class="ase-input ase-button">
              <option value="all">All</option>
              <option value="gpaw">PBE</option>
              <option value="dftd3">PBED3</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Materials type</td><td>:</td>
          <td>
            <select name="pbc" class="ase-input ase-button">
              <option value="all">All</option>
              <option value="FFT">1D</option>
              <option value="TTT">3D</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Source</td><td>:</td>
          <td>
            <select name="Source" class="ase-input ase-button">
              <option value="all">All</option>
              <option value="Derived by element substitution">Derived by element substitution</option>
              <option value="ICSD">ICSD</option>
              <option value="COD">COD</option>
              <option value="OQMD">OQMD</option>
            </select>
          </td>
          <td>
        </tr>
	<tr>
	  <td>Dynamically stable (phonons)</td><td>:</td>
	  <td>
	    <select name="dyn_phonons" class="ase-input ase-button">
              <option value="all">All</option>
              <option value="low">No</option>
              <option value="high">Yes</option>
	    </select>
	  </td>
	</tr>
	<tr>
	  <td>Thermodynamic stability</td><td>:</td>
	  <td>
	    <select name="from_tdyn" class="ase-input">
              <option value="1"{% if not q %}selected{% endif %}>Low</option>
              <option value="2">Medium</option>
              <option value="3">High</option>
	    </select>
	  </td>
	  <td>-</td>
	  <td>
	    <select name="to_tdyn" class="ase-input">
              <option value="1">Low</option>
              <option value="2">Medium</option>
              <option value="3" selected>High</option>
	    </select>
	  </td>
	</tr>
	<tr>
	  <td>Magnetic</td><td>:</td>
	  <td>
	    <select name="is_magnetic" class="ase-input">
              <option value="">All</option>
              <option value="True">Yes</option>
              <option value="False">No</option>
	    </select>
	  </td>
	</tr>
	<tr>
	  <td>Band gap range [eV]</td><td>:</td>
	  <td>
	    <input type="text" name="from_gap" value="" size="6" class="ase-input">
	  </td>
	  <td>-</td>
	  <td>
	    <input type="text" name="to_gap" value="" size="6" class="ase-input">
	  </td>
	  <td>
	    <select name="xc" class="ase-input">
              <option value="gap">PBE</option>
	    </select>
	  </td>
	</tr>
      </table>

      <div class="form-group" style="margin-bottom:0px;">
        <small class="form-text text-muted">
          <a href="https://wiki.fysik.dtu.dk/ase/ase/db/db.html#querying"
             target="_blank">
            Help with constructing advanced search queries ...
          </a>
        </small>
      </div><br/>

      {# Flash query messages #}
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <ul class="list-group">
          {% for message in messages %}
            <li class="list-group-item list-group-item-warning">{{ message }}
            </li>
          {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <small lcass="form-text text-muted">
      <a data-toggle="collapse" href="#collapse1">Toggle list of keys ...</a>
      </small><br/>
      <div id="collapse1" class="collapse">
        <table class="table table-striped">
          <tr><th>Key</th><th>Description</th><th>unit</th></tr>
          {% for key, (short, long, unit) in p.key_descriptions|dictsort %}
          <tr><td>{{ key }}</td><td>{{ long }}</td><td>{{ unit|safe }}</td></tr>
          {% endfor %}
        </table>
      </div>
    </form>
  </div>

  <div id="database1"></div>

</div> <!-- class="container" -->

{% endblock content %}
